-- DBMS Assignment 3 — MySQL Version
-- ---------------------------------

-- RESET OLD TABLES
DROP TABLE IF EXISTS Fees;
DROP TABLE IF EXISTS Students;
DROP TABLE IF EXISTS Department;
DROP VIEW IF EXISTS stu_fee_view;

-- Sample Tables
CREATE TABLE Students (
  roll_no INT,
  name VARCHAR(30),
  dept_id INT,
  marks INT
);

CREATE TABLE Department (
  dept_id INT,
  dept_name VARCHAR(30)
);

CREATE TABLE Fees (
  roll_no INT,
  amount INT
);

-- Sample Data
INSERT INTO Students VALUES (1,'Rohit',10,85);
INSERT INTO Students VALUES (2,'Sneha',20,70);
INSERT INTO Students VALUES (3,'Amit',10,90);

INSERT INTO Department VALUES (10,'Computer');
INSERT INTO Department VALUES (20,'Mechanical');

INSERT INTO Fees VALUES (1,5000);
INSERT INTO Fees VALUES (3,6000);

-- 1) INNER JOIN
SELECT s.roll_no, s.name, d.dept_name
FROM Students s
INNER JOIN Department d ON s.dept_id = d.dept_id;

-- 2) LEFT JOIN
SELECT s.name, f.amount
FROM Students s
LEFT JOIN Fees f ON s.roll_no = f.roll_no;

-- 3) RIGHT JOIN
SELECT s.name, f.amount
FROM Students s
RIGHT JOIN Fees f ON s.roll_no = f.roll_no;

-- 4) FULL OUTER JOIN (MySQL uses LEFT JOIN + RIGHT JOIN with UNION)
SELECT s.roll_no, f.amount
FROM Students s
LEFT JOIN Fees f ON s.roll_no = f.roll_no
UNION
SELECT s.roll_no, f.amount
FROM Students s
RIGHT JOIN Fees f ON s.roll_no = f.roll_no;

-- 5) SELF JOIN (Students with same dept)
SELECT a.name AS S1, b.name AS S2
FROM Students a
JOIN Students b ON a.dept_id = b.dept_id AND a.roll_no < b.roll_no;

-- 6) Single-row Subquery
SELECT name, marks
FROM Students
WHERE marks > (SELECT AVG(marks) FROM Students);

-- 7) Multi-row Subquery
SELECT name
FROM Students
WHERE dept_id IN (
    SELECT dept_id FROM Department WHERE dept_name LIKE 'C%'
);

-- 8) Correlated Subquery
SELECT roll_no, name, marks
FROM Students s
WHERE marks = (
    SELECT MAX(marks)
    FROM Students
    WHERE dept_id = s.dept_id
);

-- 9) Create View (NVL → IFNULL in MySQL)
CREATE VIEW stu_fee_view AS
SELECT 
    s.roll_no,
    s.name,
    d.dept_name,
    IFNULL(f.amount, 0) AS fees
FROM Students s
LEFT JOIN Department d ON s.dept_id = d.dept_id
LEFT JOIN Fees f ON s.roll_no = f.roll_no;

-- 10) Select From View
SELECT * FROM stu_fee_view;
