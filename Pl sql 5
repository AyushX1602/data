-- clean up if already exists (safe drops)
BEGIN
  EXECUTE IMMEDIATE 'DROP TABLE Result';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

BEGIN
  EXECUTE IMMEDIATE 'DROP TABLE Stud_Marks';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

BEGIN
  EXECUTE IMMEDIATE 'DROP FUNCTION fn_GetClass';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

BEGIN
  EXECUTE IMMEDIATE 'DROP PROCEDURE proc_Grade';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

-- Create tables
CREATE TABLE Stud_Marks (
  Roll NUMBER PRIMARY KEY,
  Name VARCHAR2(30),
  Total_Marks NUMBER
);

CREATE TABLE Result (
  Roll NUMBER,
  Name VARCHAR2(30),
  Class VARCHAR2(30)
);

-- Stored FUNCTION to return class based on marks
CREATE OR REPLACE FUNCTION fn_GetClass(p_marks IN NUMBER) RETURN VARCHAR2 IS
  v_class VARCHAR2(30);
BEGIN
  IF p_marks BETWEEN 990 AND 1500 THEN
    v_class := 'Distinction';
  ELSIF p_marks BETWEEN 900 AND 989 THEN
    v_class := 'First Class';
  ELSIF p_marks BETWEEN 825 AND 899 THEN
    v_class := 'Higher Second Class';
  ELSE
    v_class := 'Fail';
  END IF;
  RETURN v_class;
END;
/

-- Stored PROCEDURE that uses the function and fills Result table
CREATE OR REPLACE PROCEDURE proc_Grade IS
BEGIN
  FOR rec IN (SELECT Roll, Name, Total_Marks FROM Stud_Marks) LOOP
    INSERT INTO Result (Roll, Name, Class)
    VALUES (rec.Roll, rec.Name, fn_GetClass(rec.Total_Marks));
  END LOOP;
  COMMIT;
END;
/

-- Sample data
INSERT INTO Stud_Marks VALUES (1, 'Harshad', 1200);
INSERT INTO Stud_Marks VALUES (2, 'Sneha', 940);
INSERT INTO Stud_Marks VALUES (3, 'Rohit', 860);
INSERT INTO Stud_Marks VALUES (4, 'Priya', 700);
COMMIT;

-- Execute the procedure
BEGIN
  proc_Grade;
END;
/

-- View results
SET SERVEROUTPUT ON;
SELECT * FROM Result ORDER BY Roll;
